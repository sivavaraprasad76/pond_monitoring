{% extends 'base.html' %}

{% block extra_head %}
<style>
    body {
        background-color: #f0f2f5;
    }
    .card {
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }
    .graph-container {
        margin-bottom: 20px;
    }
    .table-container {
        max-height: 400px;
        overflow-y: auto;
    }
    .flash-card {
        height: 150px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    .flash-cards-container {
        background-color: #e6f2ff;
        padding: 20px;
        border-radius: 10px;
    }
    .graphs-container {
        background-color: #fff5e6;
        padding: 20px;
        border-radius: 10px;
    }
    .tables-container {
        background-color: #e6ffe6;
        padding: 20px;
        border-radius: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <!-- Flash Cards for Current Values -->
    <div class="flash-cards-container mb-4">
        <h3 class="mb-3">Current Values</h3>
        <div class="row">
            <div class="col">
                <div class="card bg-primary text-white flash-card">
                    <div class="card-body">
                        <h5 class="card-title">Dissolved Oxygen</h5>
                        <p class="card-text">{{ current_values.dissolved_oxygen }} mg/L</p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card bg-success text-white flash-card">
                    <div class="card-body">
                        <h5 class="card-title">Temperature</h5>
                        <p class="card-text">{{ current_values.temperature }} 째C</p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card bg-info text-white flash-card">
                    <div class="card-body">
                        <h5 class="card-title">pH</h5>
                        <p class="card-text">{{ current_values.ph }}</p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card bg-warning text-dark flash-card">
                    <div class="card-body">
                        <h5 class="card-title">TDS</h5>
                        <p class="card-text">{{ current_values.tds }} ppm</p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card bg-danger text-white flash-card">
                    <div class="card-body">
                        <h5 class="card-title">Turbidity</h5>
                        <p class="card-text">{{ current_values.turbidity }} NTU</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Table for Average and Min/Max Values -->
    <div class="tables-container mb-4">
        <h3 class="mb-3">Parameter Statistics</h3>
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>Parameters</th>
                        <th>Dissolved Oxygen (mg/L)</th>
                        <th>pH</th>
                        <th>Temperature (째C)</th>
                        <th>Turbidity (NTU)</th>
                        <th>TDS (ppm)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>Average</th>
                        <td>{{ avg_values.dissolved_oxygen|floatformat:2 }}</td>
                        <td>{{ avg_values.pH|floatformat:2 }}</td>
                        <td>{{ avg_values.temperature|floatformat:2 }}</td>
                        <td>{{ avg_values.turbidity|floatformat:2 }}</td>
                        <td>{{ avg_values.tds|floatformat:2 }}</td>
                    </tr>
                    <tr>
                        <th>Min</th>
                        <td>{{ min_max_values.dissolved_oxygen.min|floatformat:2 }}</td>
                        <td>{{ min_max_values.pH.min|floatformat:2 }}</td>
                        <td>{{ min_max_values.temperature.min|floatformat:2 }}</td>
                        <td>{{ min_max_values.turbidity.min|floatformat:2 }}</td>
                        <td>{{ min_max_values.tds.min|floatformat:2 }}</td>
                    </tr>
                    <tr>
                        <th>Max</th>
                        <td>{{ min_max_values.dissolved_oxygen.max|floatformat:2 }}</td>
                        <td>{{ min_max_values.pH.max|floatformat:2 }}</td>
                        <td>{{ min_max_values.temperature.max|floatformat:2 }}</td>
                        <td>{{ min_max_values.turbidity.max|floatformat:2 }}</td>
                        <td>{{ min_max_values.tds.max|floatformat:2 }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Graphs -->
    <div class="graphs-container">
        <h3 class="mb-3">Graphs</h3>
        <div class="row">
            <div class="col-md-4 graph-container">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Dissolved Oxygen (mg/L) vs Time</h5>
                        {% if do_graph %}
                            <img src="data:image/png;base64,{{ do_graph }}" class="img-fluid" alt="Dissolved Oxygen Graph">
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-4 graph-container">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Temperature (째C) vs Time</h5>
                        {% if temp_graph %}
                            <img src="data:image/png;base64,{{ temp_graph }}" class="img-fluid" alt="Temperature Graph">
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-4 graph-container">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">pH vs Time</h5>
                        {% if ph_graph %}
                            <img src="data:image/png;base64,{{ ph_graph }}" class="img-fluid" alt="pH Graph">
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-4 graph-container">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Turbidity vs Time</h5>
                        {% if turbidity_graph %}
                            <img src="data:image/png;base64,{{ turbidity_graph }}" class="img-fluid" alt="Turbidity Graph">
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-4 graph-container">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">TDS vs Time</h5>
                        {% if tds_graph %}
                            <img src="data:image/png;base64,{{ tds_graph }}" class="img-fluid" alt="TDS Graph">
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-4 graph-container">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Dissolved Oxygen (mg/L) vs Temperature (째C)</h5>
                        {% if do_temp_graph %}
                            <img src="data:image/png;base64,{{ do_temp_graph }}" class="img-fluid" alt="DO vs Temperature Graph">
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-4 graph-container">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">pH vs Temperature</h5>
                        {% if ph_temp_graph %}
                            <img src="data:image/png;base64,{{ ph_temp_graph }}" class="img-fluid" alt="pH vs Temperature Graph">
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-4 graph-container">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">All Data vs Time</h5>
                        {% if all_data_graph %}
                            <img src="data:image/png;base64,{{ all_data_graph }}" class="img-fluid" alt="All Data Graph">
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-4 graph-container">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Aerator Control</h5>
                        <form method="post" action="{% url 'toggle_aerator' %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-{% if aerator_status.is_on %}danger{% else %}success{% endif %} btn-block">
                                {% if aerator_status.is_on %}Turn Off{% else %}Turn On{% endif %} Aerator
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Latest 100 Records Table -->
    <div class="tables-container mt-4">
        <h3 class="mb-3">Latest 100 Records</h3>
        <div class="table-container">
            <table class="table table-striped table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th>Timestamp</th>
                        <th>Dissolved Oxygen (mg/L)</th>
                        <th>pH</th>
                        <th>Temperature (째C)</th>
                        <th>Turbidity (NTU)</th>
                        <th>TDS (ppm)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in latest_records %}
                    <tr>
                        <td>{{ record.timestamp|date:"Y-m-d H:i:s" }}</td>
                        <td>{{ record.dissolved_oxygen|floatformat:2 }}</td>
                        <td>{{ record.ph|floatformat:2 }}</td>
                        <td>{{ record.temperature|floatformat:2 }}</td>
                        <td>{{ record.turbidity|floatformat:2 }}</td>
                        <td>{{ record.tds|floatformat:2 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}